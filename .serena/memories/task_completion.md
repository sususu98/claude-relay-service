# 任务完成检查清单

## ✅ 代码质量检查

### 必须执行的检查
```bash
npm run lint:check            # ESLint 代码风格检查（必须通过）
npm run format:check          # Prettier 格式检查
npm test                      # 运行测试套件（如有相关逻辑变更）
```

### 代码审查要点
- [ ] **安全检查**: 确保没有硬编码密钥、敏感信息未记录到日志
- [ ] **错误处理**: 新增代码包含适当的 try-catch 和错误日志
- [ ] **性能影响**: 评估对系统性能和并发能力的影响
- [ ] **向后兼容**: API 变更不破坏现有客户端

## 🏗️ 功能特定检查

### 后端 API 修改
- [ ] 运行 `npm run lint` 修复所有代码风格问题
- [ ] 更新相关的 JSDoc 注释
- [ ] 验证新增端点的认证和权限控制
- [ ] 测试错误场景和边界条件

### 前端界面变更
```bash
npm run build:web             # 构建前端 SPA
```
- [ ] 验证明暗主题兼容性
- [ ] 检查响应式设计（手机、平板、桌面）
- [ ] 测试用户交互流程完整性

### 数据库/Redis 变更
- [ ] 验证数据迁移脚本（如需要）
- [ ] 测试数据加密/解密功能
- [ ] 确认 Redis 键过期策略正确

### 配置文件修改
- [ ] 更新 `config.example.js` 示例配置
- [ ] 验证环境变量配置完整性
- [ ] 测试不同环境下的配置加载

## 🧪 测试验证

### 自动化测试
```bash
npm test                      # 单元测试
npm run test:pricing-fallback # 价格回退测试（如相关）
```

### 手动验证场景
- [ ] **API 功能**: 使用 Claude Code CLI 或 curl 测试关键接口
- [ ] **OAuth 流程**: 完整的账户添加和 token 刷新流程
- [ ] **代理配置**: 验证不同代理类型的连接性
- [ ] **错误恢复**: 模拟 Redis 断连、API 超时等异常场景

### 性能测试（重要变更时）
```bash
# 启动服务并监控
npm run service:start:daemon
npm run monitor
```
- [ ] 响应时间测试：关键接口 < 200ms
- [ ] 并发测试：模拟 50-100 并发请求
- [ ] 内存泄漏检查：长时间运行监控

## 🚀 部署前检查

### 环境配置
- [ ] 生产环境变量配置正确
- [ ] Redis 连接和权限验证
- [ ] 日志文件权限和轮转配置

### 服务状态
```bash
npm run cli status            # 系统状态检查
npm run service:status        # PM2 进程状态
```

### 备份和回滚准备
- [ ] 导出当前数据备份
```bash
npm run data:export           # 数据备份
```
- [ ] 准备回滚方案和脚本
- [ ] 验证 Docker 镜像构建成功

## 📋 文档更新

### 代码文档
- [ ] 更新函数和类的 JSDoc 注释
- [ ] 添加复杂业务逻辑的说明注释
- [ ] 更新 API 端点的参数说明

### 用户文档（如需要）
- [ ] 更新 CLAUDE.md 中的配置说明
- [ ] 添加新功能的使用示例
- [ ] 更新故障排除指南

## ⚡ 性能优化检查

### 关键性能指标
- [ ] **内存使用**: 进程内存 < 512MB（正常负载）
- [ ] **Redis 连接**: 连接池使用率 < 80%
- [ ] **响应时间**: P95 响应时间 < 500ms
- [ ] **错误率**: API 错误率 < 1%

### 监控和告警
```bash
# 生产环境启动后验证
curl http://localhost:3000/health
curl http://localhost:3000/metrics
```

## 🔄 后续跟进

### 监控要点
- [ ] 观察错误日志：`tail -f logs/claude-relay-*.log`
- [ ] 监控系统资源：`npm run monitor`
- [ ] 用户反馈收集和问题跟踪

### 持续改进
- [ ] 性能瓶颈分析和优化机会识别
- [ ] 用户体验改进建议
- [ ] 技术债务清理计划

## 🚨 紧急回滚检查表

如果部署后发现严重问题：
```bash
# 快速回滚步骤
npm run service:stop           # 停止新版本
# 恢复代码到上一个版本
npm run data:import            # 恢复数据备份（如需要）
npm run service:start:daemon   # 启动服务
npm run cli status             # 验证回滚成功
```